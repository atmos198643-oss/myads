<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Display</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; padding: 10px; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; height: 95vh; }
        .card { background: #111; border: 2px solid #333; border-radius: 10px; padding: 10px; text-align: center; transition: 0.5s; }
        .card.active { border-color: gold; transform: scale(1.05); }
        .img-box { width: 100%; height: 150px; background: #000; margin-bottom: 10px; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .title { font-size: 1.5vw; font-weight: bold; color: #fff; text-transform: uppercase; }
        .price { font-size: 2vw; color: gold; font-weight: bold; margin-top: 5px; }
    </style>
</head>
<body>
    <div id="board" class="grid">Загрузка...</div>

    <script>
        const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQkJg-ateJ916_iAnG4ZUigWnVAh5Rhm0j7wutgrkf2Kl71EIckZiuwcZ4rvs8qEqTqfFEJHwaMdyZc/pub?output=csv";

        async function update() {
            try {
                const r = await fetch(url + "&t=" + Date.now());
                const t = await r.text();
                
                // Простейший способ разбить CSV на строки
                const rows = t.split('\n');
                let h = "";

                // Берем 12 товаров (строки с 1 по 12)
                for (let i = 1; i <= 12; i++) {
                    if (rows[i]) {
                        // Разбиваем строку по запятой
                        const cols = rows[i].split(',');
                        // Убираем лишние кавычки
                        const name = (cols[1] || "").replace(/"/g, "");
                        const price = (cols[2] || "").replace(/"/g, "");
                        const img = (cols[3] || "").replace(/"/g, "").trim();

                        h += `
                        <div class="card" id="c${i}">
                            <div class="img-box"><img src="${img}" onerror="this.style.display='none'"></div>
                            <div class="title">${name}</div>
                            <div class="price">${price}</div>
                        </div>`;
                    }
                }
                document.getElementById("board").innerHTML = h;
            } catch (err) {
                document.getElementById("board").innerHTML = "Ошибка данных";
            }
        }

        // Анимация
        let cur = 1;
        setInterval(() => {
            const all = document.querySelectorAll('.card');
            all.forEach(el => el.classList.remove('active'));
            const a = document.getElementById('c' + cur);
            if (a) a.classList.add('active');
            cur = cur >= 12 ? 1 : cur + 1;
        }, 3000);

        update();
        setInterval(update, 20000); // Обновление данных раз в 20 секунд
    </script>
</body>
</html>
